---
layout: post
title: 函数与存储过程整理
date: 2020-12-06
author: 霁
header-img:
catalog: true
categories:
- 学习
- PLSQL SQL
tags:
- PLSQL SQL
---



1. 获取表以逗号分隔的列字段

```plsql
CREATE OR REPLACE FUNCTION GET_TABLE_COLUMNS(IS_OWNER IN VARCHAR2,
                                           	IS_TABLE_NAME IN VARCHAR2)
	RETURN VARCHAR2 IS
	/*----------------------
	GET_TABLE_COLUMNS
	获取表以逗号分隔的列字段
	-----------------------*/
	RESULT	VARCHAR2;
	CV 		CLOB:='';
	TYPE REF_CUROSR_TYPE IS REF CURSOR;
	COLUMNS_CUR 	REF_CUROSR_TYPE;
	VAL				VARCHAR2(100);
    V_OWNER			VARCHAR2(100);
    V_TABLE_NAEM	VARCHAR2(100);
BEGIN 
	V_OWNER :=IS_OWNER;
	V_TABLE_NAME :=IS_TABLE_NAME;
	
	OPEN COLUMNS_CUR FOR 
		SELECT B.COLUMN_NAME AS COLUMN_NAME 
			FROM ALL_TAB_COLUMNS B
			WHERE B.TABLE_NAME = V_TABLE_NAME AND B.OWNER = V_OWNER;
	LOOP
		FETCH COLUMNS_CUR 
			INTO VAL;
		EXIT WHEN COLUMNS_CUR%NOTFOUND;
		CV := CV ||','||VAL;
	END LOOP;
	
	CV := SUBSTR(CV,2);
	RESULT := TO_CHAR(CV);
	CLOSE COLUMNS_CUR;
	RETURN(RESULT);
END GET_TABLE_COLUMNS;
```

